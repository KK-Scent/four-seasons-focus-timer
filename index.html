<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>四季のフォーカスタイマー | KK_Scent</title>
<style>
  :root {
    --bg:#f7efe3;   /* 背景（秋 初期） */
    --ink:#3b2a1a;  /* 文字（秋 初期） */
    --sub:#c27b47;  /* アクセント（秋 初期） */
    --card:#fffaf4; /* カード（秋 初期） */
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
    background:var(--bg); color:var(--ink);
  }
  .wrap{max-width:560px;margin:0 auto;padding:16px 16px 28px}
  header{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:8px 0 12px}
  .brand{display:flex;align-items:center;gap:10px}
  .leaf{font-size:24px}
  h1{font-size:18px;margin:0}
  .select{display:flex;align-items:center;gap:8px}
  select{padding:8px 10px;border-radius:10px;border:1px solid #d9cabc;background:#fff}

  .card{background:var(--card);border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,.06);padding:18px;margin:12px 0}
  .time{font-size:56px;letter-spacing:.03em;text-align:center;margin:8px 0 16px;font-variant-numeric:tabular-nums}
  .controls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
  button{padding:12px 16px;border-radius:12px;border:0;background:var(--ink);color:#fff;font-size:16px;cursor:pointer}
  button.sec{background:#e6d8cc;color:var(--ink)}
  label{display:block;margin:10px 0 0}
  input[type=range]{width:100%;margin-top:6px}

  .tabs{display:flex;gap:8px;justify-content:center;margin-bottom:8px}
  .tab{padding:8px 12px;border-radius:999px;background:#efe4da;color:#5b4433;font-size:14px;cursor:pointer;user-select:none}
  .tab.active{background:var(--ink);color:#fff}

  .row{display:grid;grid-template-columns:1fr;gap:10px}
  .stash{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}
  .stamp{width:30px;height:30px;border-radius:50%;background:#f2e6d8;display:grid;place-items:center;font-size:18px}

  footer{opacity:.7;font-size:12px;text-align:center;margin-top:16px}
  .hint{font-size:12px;opacity:.75;margin-top:6px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="leaf" id="icon">🍁</div>
      <h1 id="title">秋色フォーカスタイマー</h1>
    </div>
    <div class="select">
      <span class="hint">季節：</span>
      <select id="seasonSel" aria-label="季節を選択">
        <option value="autumn">秋 🍁</option>
        <option value="spring">春 🌸</option>
        <option value="summer">夏 ☀️</option>
        <option value="winter">冬 ❄️</option>
      </select>
    </div>
  </header>

  <div class="card">
    <div class="tabs">
      <div class="tab active" data-mode="focus">25分 集中</div>
      <div class="tab" data-mode="break">5分 休憩</div>
      <div class="tab" data-mode="custom">カスタム</div>
    </div>
    <div class="row">
      <div class="time" id="time">25:00</div>
      <div class="controls">
        <button id="start">開始</button>
        <button id="pause" class="sec">一時停止</button>
        <button id="reset" class="sec">リセット</button>
      </div>
      <label>カスタム分数 <input id="mins" type="range" min="1" max="60" value="25"></label>
      <div class="hint">完了すると季節ごとのスタンプが1つ増えます（端末に保存）。</div>
    </div>
  </div>

  <div class="card">
    <label>BGMを選択
      <select id="bgm"></select>
    </label>
    <audio id="player" preload="auto"></audio>
    <div class="hint">BGMは <code>assets/&lt;season&gt;/</code> 内の mp3 を読み込みます。</div>
  </div>

  <div class="card">
    <strong>ごほうびスタンプ</strong>
    <div class="stash" id="stash"></div>
  </div>

  <footer id="foot">© 2025 KK_Scent – Season Focus Timer</footer>
</div>

<script>
/* ==========================
   四季設定（ここを触ればOK）
   ========================== */
const SEASONS = {
  spring: {
    icon: "🌸",
    title: "桜色フォーカスタイマー",
    stamp: "🐤",
    colors: { bg:"#fff7fb", ink:"#2a2430", sub:"#e08ab3", card:"#ffffff" },
    bgm: ["spring_lofi_1.mp3","spring_lofi_2.mp3","spring_lofi_3.mp3"],
    chime: "chime_spring.mp3"
  },
  summer: {
    icon: "☀️",
    title: "海風フォーカスタイマー",
    stamp: "🐚",
    colors: { bg:"#eefaff", ink:"#103047", sub:"#3aaad6", card:"#ffffff" },
    bgm: ["summer_lofi_1.mp3","summer_lofi_2.mp3","summer_lofi_3.mp3"],
    chime: "chime_summer.mp3"
  },
  autumn: {
    icon: "🍁",
    title: "秋色フォーカスタイマー",
    stamp: "🌰",
    colors: { bg:"#f7efe3", ink:"#3b2a1a", sub:"#c27b47", card:"#fffaf4" },
    bgm: ["autumn_lofi_1.mp3","autumn_lofi_2.mp3","autumn_lofi_3.mp3"],
    chime: "chime_autumn.mp3"
  },
  winter: {
    icon: "❄️",
    title: "雪灯りフォーカスタイマー",
    stamp: "🐧",
    colors: { bg:"#f5fbff", ink:"#172733", sub:"#7aa6c8", card:"#ffffff" },
    bgm: ["winter_lofi_1.mp3","winter_lofi_2.mp3","winter_lofi_3.mp3"],
    chime: "chime_winter.mp3"
  }
};

// 要素取得
const seasonSel = document.getElementById('seasonSel');
const iconEl = document.getElementById('icon');
const titleEl = document.getElementById('title');
const footEl = document.getElementById('foot');
const bgmSel = document.getElementById('bgm');
const player = document.getElementById('player');
const stash = document.getElementById('stash');

const timeEl = document.getElementById('time');
const startBtn = document.getElementById('start');
const pauseBtn = document.getElementById('pause');
const resetBtn = document.getElementById('reset');
const minsRange = document.getElementById('mins');
const tabs = document.querySelectorAll('.tab');

// タイマー状態
let currentSeason = localStorage.getItem('season') || 'autumn';
let total=25*60, left=total, ticking=false, tId=null, mode='focus';

// 共通
function fmt(s){ const m=Math.floor(s/60), r=s%60; return `${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}` }
function render(){ timeEl.textContent = fmt(left) }
function setMode(m){
  mode=m; tabs.forEach(tb=>tb.classList.toggle('active', tb.dataset.mode===m));
  if(m==='focus'){ total=25*60 }
  else if(m==='break'){ total=5*60 }
  else { total=parseInt(minsRange.value,10)*60 }
  left=total; render();
}

// 季節適用
function applySeason(season){
  const s = SEASONS[season]; if(!s) return;
  currentSeason = season;
  localStorage.setItem('season', season);

  // 色とUI
  document.documentElement.style.setProperty('--bg', s.colors.bg);
  document.documentElement.style.setProperty('--ink', s.colors.ink);
  document.documentElement.style.setProperty('--sub', s.colors.sub);
  document.documentElement.style.setProperty('--card', s.colors.card);
  iconEl.textContent = s.icon;
  titleEl.textContent = s.title;
  document.title = `${s.title} | KK_Scent`;
  footEl.textContent = `© 2025 KK_Scent – ${s.title}`;

  // BGM選択肢
  bgmSel.innerHTML = `<option value="none">なし</option>` +
    s.bgm.map((name,i)=>`<option value="assets/${season}/${name}">${s.title} ${i+1}</option>`).join('');

  // スタンプ描画
  drawStamps(getStampCount());
}

// スタンプ（季節別で保存）
function stampKey(season){ return `stamps_${season}` }
function getStampCount(){ return Number(localStorage.getItem(stampKey(currentSeason))||'0') }
function setStampCount(n){ localStorage.setItem(stampKey(currentSeason), String(n)) }
function drawStamps(n){
  const emoji = SEASONS[currentSeason].stamp || '⭐';
  stash.innerHTML='';
  const k=Math.min(n,60);
  for(let i=0;i<k;i++){
    const d=document.createElement('div'); d.className='stamp'; d.textContent=emoji; stash.appendChild(d);
  }
}

// タイマー動作
function tick(){ if(!ticking) return; left--; render(); if(left<=0){ complete(); } }
function start(){
  if(ticking) return;
  ticking=true; clearInterval(tId); tId=setInterval(tick,1000);
  const file = bgmSel.value;
  if(file && file!=='none'){ player.src=file; player.loop=true; player.play().catch(()=>{}); }
}
function pause(){ ticking=false; clearInterval(tId); player.pause(); }
function reset(){ pause(); left=total; render(); }
function complete(){
  pause(); left=0; render();
  const n=getStampCount()+1; setStampCount(n); drawStamps(n);
  const chime = SEASONS[currentSeason].chime ? `assets/${currentSeason}/${SEASONS[currentSeason].chime}` : null;
  if(chime){ new Audio(chime).play().catch(()=>{}); }
  alert('おつかれさま！スタンプが1つ増えました 🎉\n© KK_Scent');
}

// イベント
tabs.forEach(tb=>tb.addEventListener('click',()=>setMode(tb.dataset.mode)));
minsRange.addEventListener('input', ()=>{ if(mode==='custom'){ total=parseInt(minsRange.value,10)*60; left=total; render(); } });
startBtn.addEventListener('click', start);
pauseBtn.addEventListener('click', pause);
resetBtn.addEventListener('click', reset);
bgmSel.addEventListener('change', ()=>{ if(ticking){ if(bgmSel.value==='none'){ player.pause(); } else { player.src=bgmSel.value; player.play().catch(()=>{});} }});
seasonSel.addEventListener('change', ()=>applySeason(seasonSel.value));

// 初期化
seasonSel.value = currentSeason;
applySeason(currentSeason);
setMode('focus');
render();
</script>
</body>
</html>
