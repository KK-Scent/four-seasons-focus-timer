<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å››å­£ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¿ã‚¤ãƒãƒ¼ | KK_Scent</title>
<style>
  :root {
    --bg:#f7efe3;   /* èƒŒæ™¯ï¼ˆç§‹ åˆæœŸï¼‰ */
    --ink:#3b2a1a;  /* æ–‡å­—ï¼ˆç§‹ åˆæœŸï¼‰ */
    --sub:#c27b47;  /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼ˆç§‹ åˆæœŸï¼‰ */
    --card:#fffaf4; /* ã‚«ãƒ¼ãƒ‰ï¼ˆç§‹ åˆæœŸï¼‰ */
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
    background:var(--bg); color:var(--ink);
  }
  .wrap{max-width:560px;margin:0 auto;padding:16px 16px 28px}
  header{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:8px 0 12px}
  .brand{display:flex;align-items:center;gap:10px}
  .leaf{font-size:24px}
  h1{font-size:18px;margin:0}
  .select{display:flex;align-items:center;gap:8px}
  select{padding:8px 10px;border-radius:10px;border:1px solid #d9cabc;background:#fff}

  .card{background:var(--card);border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,.06);padding:18px;margin:12px 0}
  .time{font-size:56px;letter-spacing:.03em;text-align:center;margin:8px 0 16px;font-variant-numeric:tabular-nums}
  .controls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
  button{padding:12px 16px;border-radius:12px;border:0;background:var(--ink);color:#fff;font-size:16px;cursor:pointer}
  button.sec{background:#e6d8cc;color:var(--ink)}
  label{display:block;margin:10px 0 0}
  input[type=range]{width:100%;margin-top:6px}

  .tabs{display:flex;gap:8px;justify-content:center;margin-bottom:8px}
  .tab{padding:8px 12px;border-radius:999px;background:#efe4da;color:#5b4433;font-size:14px;cursor:pointer;user-select:none}
  .tab.active{background:var(--ink);color:#fff}

  .row{display:grid;grid-template-columns:1fr;gap:10px}
  .stash{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}
  .stamp{width:30px;height:30px;border-radius:50%;background:#f2e6d8;display:grid;place-items:center;font-size:18px}

  footer{opacity:.7;font-size:12px;text-align:center;margin-top:16px}
  .hint{font-size:12px;opacity:.75;margin-top:6px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="leaf" id="icon">ğŸ</div>
      <h1 id="title">ç§‹è‰²ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¿ã‚¤ãƒãƒ¼</h1>
    </div>
    <div class="select">
      <span class="hint">å­£ç¯€ï¼š</span>
      <select id="seasonSel" aria-label="å­£ç¯€ã‚’é¸æŠ">
        <option value="autumn">ç§‹ ğŸ</option>
        <option value="spring">æ˜¥ ğŸŒ¸</option>
        <option value="summer">å¤ â˜€ï¸</option>
        <option value="winter">å†¬ â„ï¸</option>
      </select>
    </div>
  </header>

  <div class="card">
    <div class="tabs">
      <div class="tab active" data-mode="focus">25åˆ† é›†ä¸­</div>
      <div class="tab" data-mode="break">5åˆ† ä¼‘æ†©</div>
      <div class="tab" data-mode="custom">ã‚«ã‚¹ã‚¿ãƒ </div>
    </div>
    <div class="row">
      <div class="time" id="time">25:00</div>
      <div class="controls">
        <button id="start">é–‹å§‹</button>
        <button id="pause" class="sec">ä¸€æ™‚åœæ­¢</button>
        <button id="reset" class="sec">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
      <label>ã‚«ã‚¹ã‚¿ãƒ åˆ†æ•° <input id="mins" type="range" min="1" max="60" value="25"></label>
      <div class="hint">å®Œäº†ã™ã‚‹ã¨å­£ç¯€ã”ã¨ã®ã‚¹ã‚¿ãƒ³ãƒ—ãŒ1ã¤å¢—ãˆã¾ã™ï¼ˆç«¯æœ«ã«ä¿å­˜ï¼‰ã€‚</div>
    </div>
  </div>

  <div class="card">
    <label>BGMã‚’é¸æŠ
      <select id="bgm"></select>
    </label>
    <audio id="player" preload="auto"></audio>
    <div class="hint">BGMã¯ <code>assets/&lt;season&gt;/</code> å†…ã® mp3 ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚</div>
  </div>

  <div class="card">
    <strong>ã”ã»ã†ã³ã‚¹ã‚¿ãƒ³ãƒ—</strong>
    <div class="stash" id="stash"></div>
  </div>

  <footer id="foot">Â© 2025 KK_Scent â€“ Season Focus Timer</footer>
</div>

<script>
/* ==========================
   å››å­£è¨­å®šï¼ˆã“ã“ã‚’è§¦ã‚Œã°OKï¼‰
   ========================== */
const SEASONS = {
  spring: {
    icon: "ğŸŒ¸",
    title: "æ¡œè‰²ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¿ã‚¤ãƒãƒ¼",
    stamp: "ğŸ¤",
    colors: { bg:"#fff7fb", ink:"#2a2430", sub:"#e08ab3", card:"#ffffff" },
    bgm: ["spring_lofi_1.mp3","spring_lofi_2.mp3","spring_lofi_3.mp3"],
    chime: "chime_spring.mp3"
  },
  summer: {
    icon: "â˜€ï¸",
    title: "æµ·é¢¨ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¿ã‚¤ãƒãƒ¼",
    stamp: "ğŸš",
    colors: { bg:"#eefaff", ink:"#103047", sub:"#3aaad6", card:"#ffffff" },
    bgm: ["summer_lofi_1.mp3","summer_lofi_2.mp3","summer_lofi_3.mp3"],
    chime: "chime_summer.mp3"
  },
  autumn: {
    icon: "ğŸ",
    title: "ç§‹è‰²ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¿ã‚¤ãƒãƒ¼",
    stamp: "ğŸŒ°",
    colors: { bg:"#f7efe3", ink:"#3b2a1a", sub:"#c27b47", card:"#fffaf4" },
    bgm: ["autumn_lofi_1.mp3","autumn_lofi_2.mp3","autumn_lofi_3.mp3"],
    chime: "chime_autumn.mp3"
  },
  winter: {
    icon: "â„ï¸",
    title: "é›ªç¯ã‚Šãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¿ã‚¤ãƒãƒ¼",
    stamp: "ğŸ§",
    colors: { bg:"#f5fbff", ink:"#172733", sub:"#7aa6c8", card:"#ffffff" },
    bgm: ["winter_lofi_1.mp3","winter_lofi_2.mp3","winter_lofi_3.mp3"],
    chime: "chime_winter.mp3"
  }
};

// è¦ç´ å–å¾—
const seasonSel = document.getElementById('seasonSel');
const iconEl = document.getElementById('icon');
const titleEl = document.getElementById('title');
const footEl = document.getElementById('foot');
const bgmSel = document.getElementById('bgm');
const player = document.getElementById('player');
const stash = document.getElementById('stash');

const timeEl = document.getElementById('time');
const startBtn = document.getElementById('start');
const pauseBtn = document.getElementById('pause');
const resetBtn = document.getElementById('reset');
const minsRange = document.getElementById('mins');
const tabs = document.querySelectorAll('.tab');

// ã‚¿ã‚¤ãƒãƒ¼çŠ¶æ…‹
let currentSeason = localStorage.getItem('season') || 'autumn';
let total=25*60, left=total, ticking=false, tId=null, mode='focus';

// å…±é€š
function fmt(s){ const m=Math.floor(s/60), r=s%60; return `${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}` }
function render(){ timeEl.textContent = fmt(left) }
function setMode(m){
  mode=m; tabs.forEach(tb=>tb.classList.toggle('active', tb.dataset.mode===m));
  if(m==='focus'){ total=25*60 }
  else if(m==='break'){ total=5*60 }
  else { total=parseInt(minsRange.value,10)*60 }
  left=total; render();
}

// å­£ç¯€é©ç”¨
function applySeason(season){
  const s = SEASONS[season]; if(!s) return;
  currentSeason = season;
  localStorage.setItem('season', season);

  // è‰²ã¨UI
  document.documentElement.style.setProperty('--bg', s.colors.bg);
  document.documentElement.style.setProperty('--ink', s.colors.ink);
  document.documentElement.style.setProperty('--sub', s.colors.sub);
  document.documentElement.style.setProperty('--card', s.colors.card);
  iconEl.textContent = s.icon;
  titleEl.textContent = s.title;
  document.title = `${s.title} | KK_Scent`;
  footEl.textContent = `Â© 2025 KK_Scent â€“ ${s.title}`;

  // BGMé¸æŠè‚¢
  bgmSel.innerHTML = `<option value="none">ãªã—</option>` +
    s.bgm.map((name,i)=>`<option value="assets/${season}/${name}">${s.title} ${i+1}</option>`).join('');

  // ã‚¹ã‚¿ãƒ³ãƒ—æç”»
  drawStamps(getStampCount());
}

// ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆå­£ç¯€åˆ¥ã§ä¿å­˜ï¼‰
function stampKey(season){ return `stamps_${season}` }
function getStampCount(){ return Number(localStorage.getItem(stampKey(currentSeason))||'0') }
function setStampCount(n){ localStorage.setItem(stampKey(currentSeason), String(n)) }
function drawStamps(n){
  const emoji = SEASONS[currentSeason].stamp || 'â­';
  stash.innerHTML='';
  const k=Math.min(n,60);
  for(let i=0;i<k;i++){
    const d=document.createElement('div'); d.className='stamp'; d.textContent=emoji; stash.appendChild(d);
  }
}

// ã‚¿ã‚¤ãƒãƒ¼å‹•ä½œ
function tick(){ if(!ticking) return; left--; render(); if(left<=0){ complete(); } }
function start(){
  if(ticking) return;
  ticking=true; clearInterval(tId); tId=setInterval(tick,1000);
  const file = bgmSel.value;
  if(file && file!=='none'){ player.src=file; player.loop=true; player.play().catch(()=>{}); }
}
function pause(){ ticking=false; clearInterval(tId); player.pause(); }
function reset(){ pause(); left=total; render(); }
function complete(){
  pause(); left=0; render();
  const n=getStampCount()+1; setStampCount(n); drawStamps(n);
  const chime = SEASONS[currentSeason].chime ? `assets/${currentSeason}/${SEASONS[currentSeason].chime}` : null;
  if(chime){ new Audio(chime).play().catch(()=>{}); }
  alert('ãŠã¤ã‹ã‚Œã•ã¾ï¼ã‚¹ã‚¿ãƒ³ãƒ—ãŒ1ã¤å¢—ãˆã¾ã—ãŸ ğŸ‰\nÂ© KK_Scent');
}

// ã‚¤ãƒ™ãƒ³ãƒˆ
tabs.forEach(tb=>tb.addEventListener('click',()=>setMode(tb.dataset.mode)));
minsRange.addEventListener('input', ()=>{ if(mode==='custom'){ total=parseInt(minsRange.value,10)*60; left=total; render(); } });
startBtn.addEventListener('click', start);
pauseBtn.addEventListener('click', pause);
resetBtn.addEventListener('click', reset);
bgmSel.addEventListener('change', ()=>{ if(ticking){ if(bgmSel.value==='none'){ player.pause(); } else { player.src=bgmSel.value; player.play().catch(()=>{});} }});
seasonSel.addEventListener('change', ()=>applySeason(seasonSel.value));

// åˆæœŸåŒ–
seasonSel.value = currentSeason;
applySeason(currentSeason);
setMode('focus');
render();
</script>
</body>
</html>
